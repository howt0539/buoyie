<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è‡ªç”±æ½›æ°´æµ®çƒåˆ†é…ç³»çµ± v6.0 (ä¿®æ­£ç‰ˆ)</title>
    <style>
        :root {
            --bg-color: #f0f4f8;
            --card-bg: #ffffff;
            --primary: #007bff;
            --danger: #dc3545;
            --success: #28a745;
            --info: #17a2b8;
            --border: #dfe3e8;
            --coach-color: #ffebee; --coach-border: #ef9a9a;
            --high-color: #e8eaf6; --high-border: #9fa8da;
            --mid-color: #e3f2fd; --mid-border: #90caf9;
            --low-color: #e0f2f1; --low-border: #80cbc4;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background-color: var(--bg-color);
            margin: 0;
            padding: 20px;
            color: #333;
        }

        h1 { text-align: center; color: #2c3e50; margin-bottom: 20px; }

        /* æŒ‰éˆ•æ¨£å¼ */
        button {
            padding: 8px 14px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
            transition: opacity 0.2s;
            font-size: 14px;
        }
        button:hover { opacity: 0.9; }
        .btn-primary { background-color: var(--primary); color: white; }
        .btn-success { background-color: var(--success); color: white; }
        .btn-danger { background-color: var(--danger); color: white; }
        .btn-info { background-color: var(--info); color: white; }
        .btn-reset { background-color: #6c757d; color: white; }
        .btn-manage { background-color: #2c3e50; color: white; margin-right: 10px; }

        /* æ§åˆ¶é¢æ¿ */
        .controls {
            background: var(--card-bg);
            padding: 15px;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            align-items: center;
            justify-content: center;
            margin-bottom: 20px;
        }

        .control-group { display: flex; align-items: center; gap: 8px; }
        input[type="number"] {
            padding: 8px; border-radius: 6px; border: 1px solid var(--border);
            width: 60px; text-align: center; font-size: 16px;
        }

        /* æµ®çƒå€åŸŸ */
        .buoy-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
        }
        .buoy {
            background: var(--card-bg); border-radius: 12px;
            border: 2px solid transparent;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            display: flex; flexDirection: column; overflow: hidden;
            transition: all 0.2s;
        }
        .buoy.drag-over { border-color: var(--primary); background-color: #f0f7ff; }
        .buoy-header { background: #2c3e50; color: white; padding: 12px; display: flex; justify-content: space-between; align-items: center; }
        .buoy-stats { padding: 8px 12px; background: #ecf0f1; font-size: 0.9em; text-align: right; border-bottom: 1px solid var(--border); }
        .buoy-stats.over-limit { color: #c62828; font-weight: bold; background: #ffcdd2; }
        .diver-list { padding: 10px; min-height: 100px; flex-grow: 1; }

        /* æ½›æ°´å“¡å¡ç‰‡ */
        .diver-card {
            padding: 8px 10px; margin-bottom: 8px; border-radius: 8px; border: 1px solid #ccc;
            cursor: grab; display: flex; justify-content: space-between; align-items: center;
            user-select: none; position: relative;
        }
        .diver-card:active { cursor: grabbing; }
        .rank-5 { background: var(--coach-color); border-color: var(--coach-border); }
        .rank-4 { background: var(--high-color); border-color: var(--high-border); }
        .rank-3 { background: var(--mid-color); border-color: var(--mid-border); }
        .rank-2 { background: var(--low-color); border-color: var(--low-border); }
        
        .diver-info { 
            display: flex; align-items: center; gap: 8px; 
            white-space: nowrap; 
            overflow: hidden;
        }
        
        /* æ˜Ÿæ˜Ÿæ¨£å¼ */
        .leader-icon { 
            cursor: pointer; 
            font-size: 1.2em; 
            color: #ccc;
            transition: transform 0.2s;
        }
        .leader-icon:hover { transform: scale(1.2); }
        .is-auto-leader .leader-icon { color: #f1c40f; } /* é»ƒæ˜Ÿ */
        .is-manual-leader .leader-icon { color: #ff5722; text-shadow: 0 0 2px rgba(0,0,0,0.2); } /* ç´…æ˜Ÿ */

        .mobile-move { display: none; font-size: 0.8em; color: #007bff; cursor: pointer; text-decoration: underline; margin-left: auto; white-space: nowrap;}
        @media (max-width: 768px) { .mobile-move { display: block; } }

        /* å¾…åˆ†é…å€ */
        #unassigned-area {
            background: #fff3e0; border: 2px dashed #ffb74d; margin-bottom: 20px;
            padding: 15px; border-radius: 12px;
        }
        #unassigned-area .diver-list { display: flex; flex-wrap: wrap; gap: 10px; padding: 0; min-height: 50px; }
        #unassigned-area .diver-card { margin: 0; width: auto; }

        /* Modal */
        .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.5); }
        .modal-content { background-color: #fefefe; margin: 2% auto; padding: 20px; border: 1px solid #888; width: 90%; max-width: 700px; border-radius: 12px; position: relative; max-height: 95vh; display: flex; flex-direction: column; }
        .close { color: #aaa; float: right; font-size: 28px; font-weight: bold; cursor: pointer; position: absolute; right: 20px; top: 10px;}
        
        .manage-section { flex-grow: 1; overflow-y: auto; border-bottom: 2px solid #eee; margin-bottom: 15px; padding-bottom: 10px;}
        .manage-item { display: flex; justify-content: space-between; align-items: center; padding: 8px; border-bottom: 1px solid #eee; }
        .manage-item:nth-child(even) { background-color: #fafafa; }
        
        .batch-add { background: #e3f2fd; padding: 10px; border-radius: 6px; margin-bottom: 15px;}
        .batch-add textarea { width: 100%; height: 100px; margin-bottom: 10px; padding: 8px; border-radius: 4px; border: 1px solid #90caf9; box-sizing: border-box; font-family: monospace; }
        .single-add { display: flex; gap: 10px; flex-wrap: wrap; background: #f9f9f9; padding: 10px; border-radius: 6px; }
        .single-add input, .single-add select { padding: 8px; border-radius: 4px; border: 1px solid #ccc; flex-grow: 1; }

    </style>
</head>
<body>

    <h1>è‡ªç”±æ½›æ°´æµ®çƒåˆ†é…ç³»çµ±</h1>

    <div class="controls">
        <button class="btn-manage" onclick="openManager()">âš™ï¸ ç·¨è¼¯/åŒ¯å…¥åå–®</button>
        <div class="control-group">
            <label>æµ®çƒæ•¸:</label>
            <input type="number" id="buoyCount" value="4" min="1" max="20" onchange="adjustBuoyCount()">
        </div>
        <div class="control-group">
            <label>ä¸Šé™:</label>
            <input type="number" id="maxCapacity" value="4" min="1" max="10" onchange="updateAllStats()">
        </div>
        <button class="btn-primary" onclick="autoAssign()">è‡ªå‹•åˆ†é…</button>
        <button class="btn-reset" onclick="resetToUnassigned()">é‡ç½®å…¨éƒ¨</button>
    </div>

    <div id="unassigned-area">
        <div style="font-weight:bold; color:#e65100; margin-bottom:10px;">å¾…åˆ†é…äººå“¡ (æ‹–æ›³è‡³ä¸‹æ–¹)</div>
        <div class="diver-list" id="pool" ondrop="drop(event)" ondragover="allowDrop(event)"></div>
    </div>

    <div class="buoy-container" id="buoyContainer"></div>

    <div id="managerModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeManager()">&times;</span>
            <h2>äººå“¡è³‡æ–™ç®¡ç†</h2>
            
            <div class="manage-section">
                <div style="margin-bottom:10px; display:flex; justify-content:space-between; align-items:center;">
                    <strong>ç›®å‰åå–® (<span id="countDisplay">0</span> äºº)</strong>
                    <button class="btn-danger" style="font-size:12px;" onclick="clearAll()">æ¸…ç©ºå…¨éƒ¨</button>
                </div>
                <div id="manageList"></div>
            </div>

            <div class="input-section">
                <div class="batch-add">
                    <span style="font-weight:bold; color:#1565c0; display:block; margin-bottom:5px;">ğŸ“ æ‰¹é‡åŒ¯å…¥ (æ”¯æ´ Excelã€Line è²¼ä¸Š)</span>
                    <div style="font-size:0.8em; color:#555; margin-bottom:8px;">æ”¯æ´ Tabã€ç©ºæ ¼ã€æ›è¡Œåˆ†éš”ã€‚é‡è¤‡å§“åæœƒè‡ªå‹•ç•¥éã€‚</div>
                    <textarea id="batchInput" placeholder="æ•™ç·´	ç‹å°æ˜&#10;W3	æå¤§è¯&#10;A2	å¼µå°ç¾..."></textarea>
                    <button class="btn-info" onclick="batchImport()">è§£æä¸¦åŒ¯å…¥</button>
                </div>

                <div class="single-add">
                    <input type="text" id="newName" placeholder="å§“å">
                    <select id="newRole">
                        <option value="æ•™ç·´|5">æ•™ç·´</option>
                        <option value="A4|4">A4 / W3</option>
                        <option value="A3|3">A3 / W2</option>
                        <option value="A2|2">A2 / W1</option>
                    </select>
                    <button class="btn-success" onclick="addNewPerson()">æ–°å¢</button>
                    <button class="btn-reset" onclick="restoreDefault()">æ¢å¾©ç¯„ä¾‹åå–®</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ä¿®æ­£2ï¼šæ›´æ”¹ç‚ºç¯„ä¾‹åå–®
        const defaultDivers = [
            { name: "æ•™ç·´Alex", role: "æ•™ç·´", rank: 5 }, 
            { name: "æ•™ç·´Ben", role: "æ•™ç·´", rank: 5 }, 
            { name: "åŠ©æ•™Cindy", role: "W3", rank: 4 },
            { name: "å­¸å“¡David", role: "A3", rank: 3 },
            { name: "å­¸å“¡Eric", role: "A3", rank: 3 },
            { name: "å­¸å“¡Frank", role: "W2", rank: 3 },
            { name: "å­¸å“¡Gina", role: "A2", rank: 2 },
            { name: "å­¸å“¡Helen", role: "A2", rank: 2 },
            { name: "å­¸å“¡Ivy", role: "A2", rank: 2 },
            { name: "å­¸å“¡Jack", role: "A2", rank: 2 },
            { name: "å­¸å“¡Kevin", role: "A2", rank: 2 },
            { name: "å­¸å“¡Lily", role: "W2", rank: 3 }
        ];

        let divers = [];

        window.onload = function() { 
            // 1. è®€å–è³‡æ–™
            loadDivers(); 
            
            // 2. åˆå§‹åŒ–æµ®çƒ
            const buoyCount = parseInt(document.getElementById('buoyCount').value);
            const container = document.getElementById('buoyContainer');
            container.innerHTML = '';
            for(let i=1; i<=buoyCount; i++) createBuoyHTML(i, container);
            
            // 3. ä¿®æ­£3ï¼šåˆå§‹åŒ–æ™‚ï¼Œå¦‚æœ Pool æ˜¯ç©ºçš„ï¼Œè¦å…ˆæ ¹æ“šè³‡æ–™å»ºç«‹å¡ç‰‡
            const pool = document.getElementById('pool');
            if (pool.children.length === 0 && divers.length > 0) {
                divers.forEach(diver => {
                    pool.appendChild(createDiverCard(diver));
                });
            }

            // 4. è‡ªå‹•åˆ†é…
            autoAssign(); 
        };

        // ä¿®æ­£4ï¼šä½¿ç”¨ v6 keyï¼Œé¿é–‹èˆŠçš„çœŸå¯¦åå–®
        function loadDivers() {
            const saved = localStorage.getItem('freediving_divers_v6');
            divers = saved ? JSON.parse(saved) : JSON.parse(JSON.stringify(defaultDivers));
        }
        function saveDivers() { localStorage.setItem('freediving_divers_v6', JSON.stringify(divers)); }

        // --- ç®¡ç†ä»‹é¢èˆ‡å³æ™‚åŒæ­¥é‚è¼¯ ---
        function openManager() { document.getElementById('managerModal').style.display = 'block'; renderManageList(); }
        function closeManager() { document.getElementById('managerModal').style.display = 'none'; }
        window.onclick = function(event) { if (event.target == document.getElementById('managerModal')) closeManager(); }

        function renderManageList() {
            const listDiv = document.getElementById('manageList');
            document.getElementById('countDisplay').innerText = divers.length;
            listDiv.innerHTML = '';
            [...divers].sort((a,b) => b.rank - a.rank).forEach((p) => {
                const item = document.createElement('div');
                item.className = 'manage-item';
                item.innerHTML = `
                    <div style="display:flex; gap:10px; align-items:center;">
                        <span style="font-weight:bold;">${p.name}</span>
                        <span style="background:#eee; padding:2px 6px; border-radius:4px; font-size:0.8em;">${p.role}</span>
                    </div>
                    <button class="btn-danger" style="font-size:12px; padding:4px 8px;" onclick="deletePerson('${p.name}')">åˆªé™¤</button>
                `;
                listDiv.appendChild(item);
            });
        }

        function addNewPerson() {
            const name = document.getElementById('newName').value.trim();
            if(!name || divers.some(d => d.name === name)) { alert("è«‹è¼¸å…¥æœ‰æ•ˆä¸”ä¸é‡è¤‡çš„å§“å"); return; }
            const [roleName, rankVal] = document.getElementById('newRole').value.split('|');
            
            const newDiver = { name: name, role: roleName, rank: parseInt(rankVal) };
            divers.push(newDiver);
            saveDivers(); 
            renderManageList();
            document.getElementById('pool').appendChild(createDiverCard(newDiver));
            updateAllStats();
            document.getElementById('newName').value = '';
        }

        function batchImport() {
            const rawText = document.getElementById('batchInput').value.trim();
            if (!rawText) return;
            const regex = /(æ•™ç·´|W[1-3]|A[1-4])\s+([^\s]+)/gi;
            let processText = rawText.replace(/[:ï¼š]/g, ' '); 
            let match;
            let addedCount = 0;
            const pool = document.getElementById('pool');

            while ((match = regex.exec(processText)) !== null) {
                const roleRaw = match[1];
                const nameRaw = match[2].trim();
                let rank = 2;
                let role = roleRaw.toUpperCase();
                if (role.includes('æ•™ç·´')) rank = 5;
                else if (role === 'A4' || role === 'W3') rank = 4;
                else if (role === 'A3' || role === 'W2') rank = 3;
                else if (role === 'A2' || role === 'W1') rank = 2;

                if (!divers.some(d => d.name === nameRaw)) {
                    const newDiver = { name: nameRaw, role: role, rank: rank };
                    divers.push(newDiver);
                    pool.appendChild(createDiverCard(newDiver));
                    addedCount++;
                }
            }
            saveDivers(); renderManageList(); updateAllStats();
            document.getElementById('batchInput').value = '';
            if(addedCount > 0) alert(`å·²åŒ¯å…¥ä¸¦æ–°å¢ ${addedCount} äººåˆ°å¾…åˆ†é…å€`);
        }

        function deletePerson(name) {
            if(confirm(`ç¢ºå®šåˆªé™¤ ${name}ï¼Ÿ`)) { 
                divers = divers.filter(d => d.name !== name); 
                saveDivers(); 
                renderManageList();
                const card = document.getElementById(`diver-${name}`);
                if(card) card.remove();
                updateAllStats();
            }
        }

        function clearAll() {
            if(confirm("æ¸…ç©ºå…¨éƒ¨ï¼Ÿ")) { 
                divers = []; saveDivers(); renderManageList(); 
                document.getElementById('pool').innerHTML = '';
                document.querySelectorAll('.buoy-list').forEach(el => el.innerHTML = '');
                updateAllStats();
            } 
        }

        function restoreDefault() {
            if(confirm("æ¢å¾©ç¯„ä¾‹åå–®ä¸¦é‡ç½®ç•«é¢ï¼Ÿ")) { 
                divers = JSON.parse(JSON.stringify(defaultDivers)); 
                saveDivers(); 
                renderManageList();
                resetToUnassigned(); 
            } 
        }

        // --- æµ®çƒå‹•æ…‹ç®¡ç† ---
        function adjustBuoyCount() {
            const newCount = parseInt(document.getElementById('buoyCount').value);
            const container = document.getElementById('buoyContainer');
            const currentCount = container.children.length;

            if (newCount > currentCount) {
                for (let i = currentCount + 1; i <= newCount; i++) createBuoyHTML(i, container);
            } else if (newCount < currentCount) {
                const pool = document.getElementById('pool');
                for (let i = currentCount; i > newCount; i--) {
                    const buoyList = document.getElementById(`buoy-list-${i}`);
                    while (buoyList.children.length > 0) pool.appendChild(buoyList.children[0]);
                    document.getElementById(`buoy-${i}`).remove();
                }
            }
            updateAllStats();
        }

        // --- åˆ†é…æ ¸å¿ƒ ---
        function autoAssign() {
            const pool = document.getElementById('pool');
            const buoys = document.querySelectorAll('.buoy-list');
            // å›æ”¶æ‰€æœ‰äººåˆ° pool
            buoys.forEach(list => { while(list.firstChild) pool.appendChild(list.firstChild); });

            // æ’åº
            const allCards = Array.from(pool.children);
            allCards.sort((a, b) => parseInt(b.dataset.rank) - parseInt(a.dataset.rank));
            allCards.forEach(card => pool.appendChild(card));

            // åˆ†é…
            const buoyCount = parseInt(document.getElementById('buoyCount').value);
            const maxCapacity = parseInt(document.getElementById('maxCapacity').value);
            let currentBuoyIndex = 1;

            allCards.forEach(card => {
                card.dataset.manualLeader = "false"; // é‡ç½®æ‰‹å‹•çƒé•·
                let currentBuoyList = document.getElementById(`buoy-list-${currentBuoyIndex}`);
                if (currentBuoyList && currentBuoyList.children.length >= maxCapacity && currentBuoyIndex < buoyCount) {
                    currentBuoyIndex++;
                    currentBuoyList = document.getElementById(`buoy-list-${currentBuoyIndex}`);
                }
                if(currentBuoyList) currentBuoyList.appendChild(card);
            });
            updateAllStats();
        }

        function resetToUnassigned() {
            const pool = document.getElementById('pool');
            pool.innerHTML = ''; // æ¸…ç©ºç›®å‰çš„ DOM
            // é‡æ–°æ ¹æ“š divers è³‡æ–™å»ºç«‹å¡ç‰‡
            [...divers].sort((a,b) => b.rank - a.rank).forEach(d => {
                pool.appendChild(createDiverCard(d));
            });
            
            // æ¸…ç©ºæµ®çƒå…§å®¹
            const buoys = document.querySelectorAll('.buoy-list');
            buoys.forEach(list => list.innerHTML = '');
            
            updateAllStats();
        }

        // ä¿®æ­£1ï¼šæµ®çƒHeaderç§»é™¤æ–‡å­—
        function createBuoyHTML(id, container) {
            const div = document.createElement('div');
            div.className = 'buoy';
            div.id = `buoy-${id}`;
            div.innerHTML = `
                <div class="buoy-header">
                    <span style="font-weight:bold;">æµ®çƒ #${id}</span>
                    </div>
                <div class="buoy-stats" id="stats-${id}">0 äºº</div>
                <div class="diver-list buoy-list" id="buoy-list-${id}" 
                     ondrop="drop(event)" ondragover="allowDrop(event)" data-buoy-id="${id}"></div>
            `;
            container.appendChild(div);
        }

        function createDiverCard(diver) {
            const div = document.createElement('div');
            div.className = `diver-card rank-${diver.rank}`;
            div.draggable = true;
            div.id = `diver-${diver.name}`;
            div.dataset.rank = diver.rank; div.dataset.name = diver.name; div.dataset.role = diver.role;
            div.dataset.manualLeader = "false"; 

            div.ondragstart = drag;
            div.innerHTML = `
                <div class="diver-info">
                    <span class="leader-icon" onclick="toggleLeader(this, event)" title="é»æ“Šè¨­ç‚ºæµ®çƒé•·">â˜…</span>
                    <strong>${diver.name}</strong>
                    <span style="font-size:0.75em; padding:2px 6px; border-radius:4px; background:rgba(0,0,0,0.1); font-weight:bold;">${diver.role}</span>
                </div>
                <span class="mobile-move" onclick="showMobileMenu(this)">ç§»å‹•</span>
            `;
            return div;
        }

        function toggleLeader(icon, event) {
            event.stopPropagation();
            const card = icon.closest('.diver-card');
            const list = card.parentElement;
            if(list.id === 'pool') { alert("è«‹å…ˆå°‡äººå“¡ç§»å…¥æµ®çƒå¾Œå†æŒ‡å®šçƒé•·"); return; }
            const isCurrentlyManual = card.dataset.manualLeader === "true";
            Array.from(list.children).forEach(c => c.dataset.manualLeader = "false");
            if (!isCurrentlyManual) card.dataset.manualLeader = "true";
            updateAllStats();
        }

        function updateAllStats() {
            const buoyCount = parseInt(document.getElementById('buoyCount').value);
            const maxCapacity = parseInt(document.getElementById('maxCapacity').value);
            
            for (let i = 1; i <= buoyCount; i++) {
                const list = document.getElementById(`buoy-list-${i}`);
                if (!list) continue;
                const cards = Array.from(list.children);
                const count = cards.length;
                const statsDiv = document.getElementById(`stats-${i}`);
                
                statsDiv.textContent = `${count} / ${maxCapacity} äºº`;
                statsDiv.className = `buoy-stats ${count > maxCapacity ? 'over-limit' : ''}`;
                
                // é‡ç½®æ‰€æœ‰æ˜Ÿæ˜Ÿç‹€æ…‹
                cards.forEach(c => { c.classList.remove('is-auto-leader'); c.classList.remove('is-manual-leader'); });
                
                // è¨ˆç®—èª°è©²äº®ç‡ˆ
                if (count > 0) {
                    const manualLeader = cards.find(c => c.dataset.manualLeader === "true");
                    if (manualLeader) {
                        manualLeader.classList.add('is-manual-leader'); // ç´…æ˜Ÿ
                    } else {
                        const maxRank = Math.max(...cards.map(c => parseInt(c.dataset.rank)));
                        const autoLeader = cards.find(c => parseInt(c.dataset.rank) === maxRank);
                        if(autoLeader) autoLeader.classList.add('is-auto-leader'); // é»ƒæ˜Ÿ
                    }
                }
            }
        }

        function allowDrop(ev) { ev.preventDefault(); const buoy = ev.target.closest('.buoy'); if(buoy) buoy.classList.add('drag-over'); }
        document.addEventListener('dragleave', function(ev) { if (ev.target.classList && ev.target.classList.contains('buoy')) { ev.target.classList.remove('drag-over'); }});
        function drag(ev) { ev.dataTransfer.setData("text", ev.target.id); }
        function drop(ev) {
            ev.preventDefault(); document.querySelectorAll('.buoy').forEach(b => b.classList.remove('drag-over'));
            var data = ev.dataTransfer.getData("text"); var draggedElement = document.getElementById(data);
            let target = ev.target; while (target && !target.classList.contains('diver-list')) target = target.parentElement;
            if (target) { target.appendChild(draggedElement); updateAllStats(); }
        }
        function showMobileMenu(btn) {
            const card = btn.closest('.diver-card');
            const buoyCount = parseInt(document.getElementById('buoyCount').value);
            let options = [`\n- å¾…åˆ†é…å€ (è¼¸å…¥ 0)`];
            for(let i=1; i<=buoyCount; i++) options.push(`- æµ®çƒ ${i} (è¼¸å…¥ ${i})`);
            const choice = prompt(`å°‡ ${card.dataset.name} ç§»å‹•åˆ°å“ªè£¡ï¼Ÿ\nè«‹è¼¸å…¥æ•¸å­—ï¼š${options.join('')}`);
            if (choice !== null) {
                let targetId = (choice === '0') ? 'pool' : `buoy-list-${parseInt(choice)}`;
                const target = document.getElementById(targetId);
                if (target) { target.appendChild(card); updateAllStats(); }
            }
        }
    </script>
</body>
</html>